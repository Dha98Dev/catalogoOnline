<!-- esto es para buscar un nuevo diseño por su codigo -->
<div class="px-3 py-3 flex items-center gap-3">
    <p-floatlabel variant="on">
    <input pInputText id="on_label" #codigo  autocomplete="off" class="!border-slate-400 !focus:border-gray-600 !focus:ring-gray-600" />
    <label for="on_label" class="!text-slate-600">Codigo de diseño</label>
</p-floatlabel>
<p-button icon="pi pi-search" size="small" severity="contrast" (onClick)="this.codigoDisenio =codigo.value;cargarDetalleDisenio()"/>
</div>

@if (disenios.length) {
  <div class="w-[95%] mx-auto p-4">

    <!-- Recorremos cada diseño -->
    @for (disenio of disenios; track disenio.codigoDisenio) {
      <div class="bg-white rounded-2xl shadow-md p-6 mb-8">
        <!-- Header del diseño -->
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-3 mb-4">
          <div>
            <h1 class="text-2xl font-bold text-gray-900">
              {{ disenio.nombreDisenio }}
            </h1>
            <p class="text-sm text-gray-500">
              Código:
              <span class="font-mono font-semibold text-gray-800">
                {{ disenio.codigoDisenio }}
              </span>
            </p>
          </div>

          <!-- Productos donde está disponible (tomados de la primera imagen) -->
          <div class="flex flex-wrap items-center gap-2">
            <span class="text-xs uppercase tracking-wide text-gray-400">
              Disponible en:
            </span>

            @if (disenio.imagenes?.length) {
              @for (prod of disenio.imagenes[0].disponibilidadProducto; track prod) {
                <p-tag
                  [value]="prod"
                  severity="success"
                  class="text-xs"
                ></p-tag>
              }
            }
          </div>
        </div>

        <p-divider></p-divider>

        <!-- Secciones por imagen (principal / secundaria / otras) -->
        <div class="mt-4 space-y-6">
          @for (img of disenio.imagenes; track img.nombreFile; let i = $index) {
            <section class="border border-gray-100 rounded-2xl p-4 bg-gray-50/60">
              <!-- Encabezado de la imagen -->
              <div class="flex items-center justify-between mb-3 gap-2">
                <div class="flex items-center gap-2">
                  <span class="text-sm font-semibold text-gray-800">
                    {{ (img.tipoImagen || ('Imagen ' + (i + 1))) | titlecase }}
                  </span>

                  @if (img.tipoImagen === 'principal') {
                    <span class="inline-flex items-center rounded-full bg-emerald-100 text-emerald-700 text-[11px] px-2 py-0.5 font-medium">
                      Principal
                    </span>
                  } @else if (img.tipoImagen === 'secundaria') {
                    <span class="inline-flex items-center rounded-full bg-sky-100 text-sky-700 text-[11px] px-2 py-0.5 font-medium">
                      Secundaria
                    </span>
                  }
                </div>

                <span class="text-[11px] text-gray-400">
                  Archivo: {{ img.nombreFile }}
                </span>
              </div>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Columna izquierda: preview de la imagen -->
                <div class="flex flex-col items-center gap-3">
                  <p-image
                    [src]="baseUrlFiles + img.urlPath"
                    alt="{{ disenio.nombreDisenio }} - {{ img.tipoImagen }}"
                    class="rounded-xl overflow-hidden shadow-md max-h-80"
                    [preview]="true"
                  ></p-image>

                  <div class="text-xs text-gray-500 text-center">
                    <div class="font-semibold text-gray-700">
                      {{ img.nombreFile }}
                    </div>
                    <div>{{ img.tipoArchivo }}</div>
                    <div>
                      Tipo de imagen:
                      <span class="font-medium text-indigo-600">
                        {{ img.tipoImagen | titlecase }}
                      </span>
                    </div>
                  </div>

                  <!-- Colores disponibles (chips + cuadritos de color) -->
                  <div class="w-full">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">
                      Colores disponibles
                    </h3>

                    <div class="flex flex-wrap gap-2 items-center">
                      @for (color of img.disponibilidadColores; track color; let idx = $index) {
                        <div
                          class="flex items-center gap-1 px-2 py-1 bg-white rounded-full border border-gray-200 shadow-sm"
                        >
                          <span
                            class="inline-block w-4 h-4 rounded-full border border-gray-300"
                            [ngStyle]="{
                              'background-color': img.hexColores[idx] || '#e5e7eb'
                            }"
                          ></span>
                          <span class="text-xs text-gray-700">
                            {{ color }}
                          </span>
                          <span class="text-[10px] text-gray-400 font-mono ml-1">
                            {{ img.hexColores[idx] }}
                          </span>
                        </div>
                      }
                    </div>
                  </div>
                </div>

                <!-- Columna derecha: detalles, palabras clave y medidas -->
                <div class="space-y-4">

                  <!-- Palabras clave -->
                  <div>
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">
                      Palabras clave
                    </h3>
                    <div class="flex flex-wrap gap-2">
                      @for (palabra of img.palabrasClave; track palabra) {
                        <p-chip
                          [label]="palabra"
                          class="text-xs"
                        ></p-chip>
                      }
                    </div>
                  </div>

                  <!-- Resumen de info -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                    <div class="bg-white rounded-xl p-3 border border-gray-100">
                      <div class="font-semibold text-gray-700 mb-1">
                        Archivo
                      </div>
                      <div class="text-gray-600 break-all">
                        {{ img.urlPath }}
                      </div>
                    </div>

                    <div class="bg-white rounded-xl p-3 border border-gray-100">
                      <div class="font-semibold text-gray-700 mb-1">
                        Productos / Colores
                      </div>
                      <div class="text-gray-600 text-xs">
                        Productos:
                        <span class="font-medium">
                          {{ img.disponibilidadProducto.join(', ') }}
                        </span>
                      </div>
                      <div class="text-gray-600 text-xs">
                        Colores:
                        <span class="font-medium">
                          {{ img.disponibilidadColores.join(', ') }}
                        </span>
                      </div>
                    </div>
                  </div>

                  <!-- Tabla de medidas -->
                  <div>
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">
                      Medidas y posiciones
                    </h3>

                    <p-table
                      [value]="img.medidas"
                      styleClass="p-datatable-sm text-xs"
                      [paginator]="false"
                      responsiveLayout="scroll"
                    >
                      <ng-template pTemplate="header">
                        <tr>
                          <th>Orientación</th>
                          <th>Medida</th>
                          <th>Tamaño</th>
                          <th>Posición</th>
                          <th class="hidden md:table-cell">Mockup</th>
                          <th class="hidden md:table-cell">Tamaño img</th>
                        </tr>
                      </ng-template>

                      <ng-template pTemplate="body" let-med>
                        <tr>
                          <td>
                            {{ med.orientacion || 'N/A' }}
                          </td>
                          <td>
                            <span class="font-mono font-semibold">
                              {{ med.codigoMedida }}
                            </span>
                          </td>
                          <td>
                            {{ med.tamanoText }}
                          </td>
                          <td>
                            {{ med.posicionText }}
                          </td>
                          <td class="hidden md:table-cell">
                            <span class="inline-flex items-center gap-1">
                              @if (med.urlPosicion) {
                                <img
                                  [src]="'./assets/images/medidas/' + med.urlPosicion"
                                  alt="{{ med.codigoMedida }}"
                                  class="w-10 h-10 object-contain border rounded-md bg-white"
                                />
                              }
                            </span>
                          </td>
                          <td class="hidden md:table-cell">
                            {{ med.tamanioImagen || '—' }}
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </div>
              </div>
            </section>
          }
        </div>
      </div>
    }
  </div>
} @else {
  <!-- Estado vacío -->
  <div class="max-w-4xl mx-auto p-6 text-center text-gray-500">
    No hay información del diseño para mostrar.
  </div>
}
